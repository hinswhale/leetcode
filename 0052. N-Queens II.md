52. N-Queens II


Given an integer n, return the number of distinct solutions to the n-queens puzzle.

 

Example 1:
![image](https://github.com/hinswhale/leetcode/assets/22999866/c251d39e-b56c-437d-b383-6b1a72197931)


Input: n = 4
Output: 2
Explanation: There are two distinct solutions to the 4-queens puzzle as shown.
Example 2:

Input: n = 1
Output: 1
 

Constraints:

1 <= n <= 9

## Solution 

```python
class Solution:
    def totalNQueens(self, n: int) -> int:
        def backtrack(row, ld, rd, col):
            nonlocal count
            if row == n:
                count += 1
                return
            bits = ~(ld | rd | col) & ((1 << n) - 1)
            while bits:
                p = bits & -bits
                bits &= bits - 1
                backtrack(row + 1, (ld | p) << 1, (rd | p) >> 1, col | p)
            return

        count = 0
        backtrack(0, 0, 0, 0)
        return count

```

```
ld (左对角线):  0000
rd (右对角线):  0000
col (列):       0000
`ld | rd | col`: 在当前行的这些位置上存在皇后
`~(ld | rd | col)`:在这些位置上没有皇后
`(1 << n) - 1` : (1 << 4) - 1 = 00010000 - 1 = 00001111, 即所有位置都是可用

```

## 解析
```markdown
让我们通过一个具体的例子，来说明这两个表达式是如何在 N 皇后问题中工作的。

### 示例：N = 4

#### 初始情况：
```yaml
n = 4

ld (左对角线):  0000
rd (右对角线):  0000
col (列):       0000
```

#### 第一行尝试在第1列放置皇后：
```yaml
Place Queen at (0, 1)

ld | rd | col:   0000 | 0000 | 0001 = 0001
~(ld | rd | col): 1110
(1 << n) - 1:      0000 | 0000 | 0000 | 0000 | 0000 | 0000 | 0000 | 1111 = 1111

Result:           1110 & 1111 = 1110
```
此时，`~(ld | rd | col) & ((1 << n) - 1)` 的结果表示在第一行中可用的位置是 `1110`。

更新占用情况：
```yaml
(ld | p) << 1:   (0001 | 0001) << 1 = 0010
(rd | p) >> 1:   (0001 | 0001) >> 1 = 0001
col | p:         0000 | 0001 = 0001

Updated ld:      0010
Updated rd:      0001
Updated col:     0001
```

#### 第二行尝试在第3列放置皇后：
```yaml
Place Queen at (1, 3)

ld | rd | col:   0010 | 0001 | 1000 = 1011
~(ld | rd | col): 0100
(1 << n) - 1:      1111

Result:           0100 & 1111 = 0100
```
此时，`~(ld | rd | col) & ((1 << n) - 1)` 的结果表示在第二行中可用的位置是 `0100`。

更新占用情况：
```yaml
(ld | p) << 1:   (0010 | 0100) << 1 = 1010
(rd | p) >> 1:   (0001 | 0100) >> 1 = 0101
col | p:         0001 | 0100 = 0101

Updated ld:      1010
Updated rd:      0101
Updated col:     0101
```
```
